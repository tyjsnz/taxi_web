<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <title>网约车平台 - 评价管理</title>
    <!-- 引入Element-UI样式 -->
    <link rel="stylesheet" href="/static/libs/element-ui/css/element-ui.css">
    <!-- 引入字体图标 -->
    <link rel="stylesheet" href="//at.alicdn.com/t/c/font_4790197_oudfd3w0r9.css">
    <!-- 保持原有的CSS和JS引用 -->
    <style>
        /* 新增评价相关样式 */
        .rating-tag {
            padding: 5px 10px;
            border-radius: 4px;
        }
        .rating-excellent {
            background: #f0f9eb;
            color: #67c23a;
        }
        .rating-good {
            background: #fdf6ec;
            color: #e6a23c;
        }
        .rating-bad {
            background: #fef0f0;
            color: #f56c6c;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="app-container">
            <!-- 头部区域 -->
            <div class="header">
            </div>
            <!-- 搜索区域 -->
            <el-card shadow="never" class="search-card">
                <el-form :inline="true" :model="searchForm">
                    <el-form-item label="车牌号">
                        <el-input v-model="searchForm.plateNumber" placeholder="请输入车牌号"></el-input>
                    </el-form-item>
                    <el-form-item label="司机姓名">
                        <el-input v-model="searchForm.driverName" placeholder="请输入司机姓名"></el-input>
                    </el-form-item>
                    <el-form-item label="手机号">
                        <el-input v-model="searchForm.phone" placeholder="请输入手机号"></el-input>
                    </el-form-item>
                    <el-form-item label="评价时间">
                        <el-date-picker
                            v-model="searchForm.dateRange"
                            type="daterange"
                            range-separator="至"
                            value-format="yyyy-MM-dd">
                        </el-date-picker>
                    </el-form-item>
                    <el-form-item>
                        <el-button type="primary" @click="handleSearch">查询</el-button>
                        <el-button @click="refreshList" icon="el-icon-refresh">刷新</el-button>
                    </el-form-item>
                </el-form>
            </el-card>

            <!-- 表格区域 -->
            <div class="table-container">
                <el-table :data="tableData" border v-loading="loading">
                    <el-table-column prop="order_id" label="订单号" width="180"></el-table-column>
                    <el-table-column label="司机信息" width="220">
                        <template slot-scope="scope">
                            <div>姓名：${ scope.row.truename }</div>
                            <div>车牌：${ scope.row.car_no }</div>
                            <div>电话：${ scope.row.phone }</div>
                        </template>
                    </el-table-column>
                    <el-table-column label="评分" width="120">
                        <template slot-scope="scope">
                            <el-rate 
                                v-model="scope.row.score"
                                disabled
                                show-score
                                :colors="['#F56C6C', '#E6A23C', '#67C23A']">
                            </el-rate>
                        </template>
                    </el-table-column>
                    <el-table-column prop="comment" label="评价内容">
                        <template slot-scope="scope">
                            <div class="notice-content">${ scope.row.remark }</div>
                        </template>
                    </el-table-column>
                    <el-table-column prop="created_at" label="评价时间" width="180"></el-table-column>
                    <el-table-column label="操作" width="100">
                        <template slot-scope="scope">
                            <el-button
                                size="mini"
                                type="danger"
                                @click="handleDelete(scope.$index, scope.row)">删除</el-button>
                        </template>
                    </el-table-column>
                </el-table>

                <!-- 分页 -->
                <div class="pagination">
                    <el-pagination
                        @size-change="handleSizeChange"
                        @current-change="handleCurrentChange"
                        :current-page="currentPage"
                        :page-sizes="[10, 20, 50]"
                        :page-size="pageSize"
                        layout="total, sizes, prev, pager, next"
                        :total="total">
                    </el-pagination>
                </div>
            </div>
        </div>
    </div>

    <!-- 引入Vue和Element-UI -->
    <!-- 引入Vue和Element-UI -->
    <script src="/static/libs/element-ui/js/vue.js"></script>
    <script src="/static/libs/element-ui/js/element-ui.js"></script>
    <script src="/static/libs/axios.min.js"></script>
    <script src="/static/common/jquery.3.7.1.js"></script>
    <script src="/static/utils/helper.js"></script>

    <script>
        new Vue({
            el: '#app',
            delimiters: ['${', '}'],
            data() {
                return {
                    searchForm: {
                        plateNumber: '',
                        driverName: '',
                        phone: '',
                        dateRange: []
                    },
                    tableData: [],
                    loading: false,
                    currentPage: 1,
                    pageSize: 10,
                    total: 0
                }
            },
            created() {
                this.getList();
            },
            methods: {
                // 获取评价列表
                getList() {
                    this.loading = true;
                    var that = this
                    
                    $.ajax({
                        url: '/admin/evaluation/json',
                        type: 'get',
                        dataType: 'json',
                        success: function(res){
                            that.tableData = res.data
                            that.loading = false;
                        }
                    })
                    // 模拟数据
                    /*setTimeout(() => {
                        this.tableData = [
                            {
                                orderId: 'DD20231015001',
                                driverName: '张三',
                                plateNumber: '京A12345',
                                phone: '13800138000',
                                rating: 4.5,
                                comment: '司机服务态度很好，车内环境整洁',
                                createTime: '2023-10-15 14:30:00'
                            },
                            {
                                orderId: 'DD20231014002',
                                driverName: '李四',
                                plateNumber: '沪B56789',
                                phone: '13900139000',
                                rating: 3.0,
                                comment: '路线选择不够合理',
                                createTime: '2023-10-14 09:15:00'
                            }
                        ];
                        this.total = this.tableData.length;
                        this.loading = false;
                    }, 500);
                    */
                },

                // 删除评价
                handleDelete(index, row) {
                    this.$confirm('确定删除该评价？', '提示', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消'
                    }).then(() => {
                        this.tableData.splice(index, 1);
                        this.total -= 1;
                        this.$message.success('删除成功');
                    });
                },

                // 其他方法保持与通知页面相同的分页和搜索逻辑
                handleSearch() { /*...*/ },
                handleSizeChange(val) { /*...*/ },
                handleCurrentChange(val) { /*...*/ },
                refreshList() { /*...*/ }
            }
        });
    </script>
</body>
</html>