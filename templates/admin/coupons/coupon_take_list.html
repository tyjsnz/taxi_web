{% extends '/admin/common/base.html' %}


{% block content %}

<div class="container-fluid p-t-15">

    <div class="row">
        <div class="col-lg-12">
            <div class="card">

                <div class="card-body">
                    <table id="test" lay-filter="test"></table>
                    <script type="text/html" id="toolbarDemo">
                    </script>
                  
                </div>
            </div>
        </div>
    </div>
</div>
<script src="/static/utils/helper.js"></script>
<script>
    var take_id = "{{id}}"
    const param = getQueryParams()
    console.log(param)
    function formatDateTime(dateStr) {
        const date = new Date(dateStr);
        return date.getUTCFullYear() + '-' +
            String(date.getUTCMonth() + 1).padStart(2, '0') + '-' +
            String(date.getUTCDate()).padStart(2, '0') + ' ' +
            String(date.getUTCHours()).padStart(2, '0') + ':' +
            String(date.getUTCMinutes()).padStart(2, '0') + ':' +
            String(date.getUTCSeconds()).padStart(2, '0');
    }
    layui.use(['table'], function () {
        var table = layui.table
            , $ = layui.$
            , laytpl = layui.laytpl
            , laydate = layui.laydate;
        //全局设定某参数
        table.set({
            where: {
                token: ''
            }
            , defaultToolbar: ["filter", "exports", "print"]
            , toolbar: true
            , loading: true
        });

        var option = {
            elem: '#test'
            , toolbar: '#toolbarDemo'
            , height: 550
            , title: '优惠券领用记录表'
            , url: `/admin/coupons/take/list/json?id=${take_id}&flag=${param.flag}&uid=${param.uid}&utype=${param.utype}`
            , request: {
                pageName: 'page' //页码的参数名称，默认：page
                , limitName: 'pagesize' //每页数据量的参数名，默认：limit
            }
            , page: true
            , limit: 50
            , loading: true
            , limits: [50, 100, 200]
            , cols: [[
                { field: 'id', title: '优惠券编号', width: 120 }
                ,{ field: 'take_code', title: '领用编码', width: 140 }
                ,{ field: 'utype', title: '领取用户类型', sort: true, width: 140,templet:function(d){
                    if(d.utype == 0){
                        return '乘客';
                    }else if(d.type == 1){
                        return '司机';
                    }else{
                        return '其它';
                    }
                } }
                , { field: 'truename', title: '领用人姓名', width: 120 }
                , { field: 'phone', title: '电话', width: 120 }
                , { field: 'name', title: '优惠券名称', width: 250 }
                , { field: 'amount', title: '面额(元)', sort: true, width: 120 ,templet:function(d){
                    return "<span style='color:red'>" + d.amount + "</span>"
                }}
                , { field: 'condition_amount', title: '使用条件', width: 120,templet:function(d){
                    if(d.condition_amount == 0){
                        return '无门槛';
                    }else {
                        return '<span class="layui-badge layui-bg-green">满' + d.condition_amount + '元可用</span>'
                        //return `<span class="el-tag el-tag--small el-tag--primary permission-tag">${d.condition_amount}</span>`;
                    }
                } }
                , { field: 'valid_date', title: '有效期', width: 300,templet:function(d){
                    
                    if(d.valid_type == 0)
                    return '<span class="layui-badge">' + d.start_date + "-" + d.end_date + '</span>'
                    else
                        return '<span class="layui-badge">领取后' + d.valid_days + '天</span>';
                } }
                , { field: 'status', title: '当前状态', sort: true, width: 120 ,templet:function(d){
                    if(d.status == 0)
                        return '<span class="layui-badge layui-bg-green">未使用</span>'
                    else if(d.status == 1)
                        return '<span class="layui-badge layui-bg-blue">已使用</span>'
                    else if(d.status == -1)                
                        return '<span class="layui-badge layui-bg-gary">过期</span>'
                }}
                , { field: 'use_range', title: '适用于', width: 120,templet:function(d){
                    if(d.use_range == 0)
                        return '快车';
                    else if(d.use_range == 1)
                        return '城际快车';
                    else if(d.use_range == 11)
                        return '快车/城际快车';
                } }
                , { field: 'updated_at', title: '使用用时间', width: 180 }
                , { field: 'created_at', title: '领用时间', width: 180 }
                , { field: 'description', title: '描述', width: 220 }
            ]]
            , error: function (res, msg) {
            }
            , response: {
                statusName: 'status'
                , statusCode: 0
            }
            , done: function (res, curr, count) {
                //当数据渲染完后，执行的回调
            }
            , parseData: function (res) {

                return {
                    "status": res.status
                    , "msg": res.msg
                    , "count": res.other.total
                    , "data": res.data
                };
            }
        }

        table.render(option);

       
        table.on('tool(test)', function (obj) {
            var data = obj.data;
            if (obj.event === 'del') {
               
            }
            else if (obj.event == 'edit') {
               
            }
        });
        
    });
</script>

{% endblock %}