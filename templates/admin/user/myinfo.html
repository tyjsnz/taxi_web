
{% extends '/admin/common/base.html' %}

{% block content %}
<link rel="stylesheet" href="/static/libs/element-ui/css/element-ui.css">
<style>
  input[type=file]{
                  display: none !important;
                }
</style>
  <div class="container-fluid p-t-15" id="app">
  
    <div class="row">
      <div class="col-lg-12">
        <div class="card">
          <div class="card-body">
            
            <el-row>
                <el-col :span="10">
                    <el-form label-position="top" label-width="80px" size="mini">
                      <el-form label-position="top" label-width="80px" size="mini">
                        <el-form-item label="登录用户名">
                        <el-input v-model="username" disabled></el-input>
                        </el-form-item>
                      </el-form>
                        <el-form-item label="真实姓名">
                        <el-input v-model="truename"></el-input>
                        </el-form-item>
                        <el-form-item label="联系电话">
                        <el-input v-model="phone"></el-input>
                        </el-form-item>
                    </el-form>
                </el-col>                              
            </el-row>
            
            <el-row>
              <el-col :span="10" size="mini">
                <el-form label-position="top" label-width="80px" size="mini">
                  <el-form-item label="新密码">
                  <el-input type="password" v-model="pwd1"></el-input>
                  <el-link disabled>如不修改密码，则留空即可</el-link>
                  </el-form-item>
                </el-form>
                <el-form label-position="top" label-width="80px" size="mini">
                  <el-form-item label="重复新密码">
                  <el-input type="password" v-model="pwd2"></el-input>
                  <el-link disabled>如不修改密码，则留空即可</el-link>
                  </el-form-item>
                </el-form>
              </el-col>
            </el-row>
         
            <el-row>
              <button type="button" class="btn btn-primary multitabs" target-form="add-form" @click="add_data">确 定</button>
              <button type="button" class="btn btn-default multitabs" onclick="javascript:location.reload();return false;">重 置</button>
            </el-row>
            
          </div>
        </div>
      </div>
      
    </div>
    
  </div>


  <script src="/static/libs/element-ui/js/vue.min.js"></script>
  <script src="/static/libs/element-ui/js/element-ui.js"></script>
  
	<!-- 实例化编辑器 -->
	<script type="text/javascript">
    new Vue({
      el: "#app",
      delimiters: ['${', '}'],
      data() {
        return {
            id: "{{ row['id'] }}",
            truename: "{{ row['truename'] }}",
            phone: "{{ row['phone'] }}",
            username: "{{ row['username'] }}",
            pwd1:'',
            pwd2:''
        };
      },
      mounted() {
       
      },
      methods: {
        add_data(){
          var that = this
          if(this.pwd1 != '' || this.pwd2 != ''){
            if(this.pwd1 != this.pwd2){
              that.$message.error('两次密码不一致')
              return
            }
          }
          if(this.truename == ''){
            that.$message.error('真实姓名不能为空')
            return
          }
          if(this.phone == ''){
            that.$message.error('联系电话不能为空')
            return
          }
          
          $.ajax({
            url: '/admin/user/myinfo',
            type: 'POST',
            dataType: 'json',
            data: {
              id: that.id,
              truename: that.truename,
              phone: that.phone,
              pwd1: that.pwd1,
              pwd2: that.pwd2,
            },
            success: function(res) {
              if(res.status == 0){
                that.$message.success(res.msg)
                setTimeout(function(){
                  window.location.href = '/admin/user/myinfo'
                }, 1500)
              }else{
                that.$message.error(res.msg)
              }
            }
          })
        },
      }
    })
  </script>
  {% endblock %}