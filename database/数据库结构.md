# 数据库文档

## 数据库概述

本数据库用于LS出行的运营数据，包括公司信息、司机信息、订单信息、优惠券信息等。数据库使用MySQL 5.7.26版本，字符集为utf8mb4。最终结构参照ls_taxi.sql

## 表结构说明

### ls_company - 运营公司表

| 字段名        | 类型         | 默认值 | 注释                       |
| ------------- | ------------ | ------ | -------------------------- |
| id            | int(11)      | NOT NULL AUTO_INCREMENT | 公司ID               |
| name          | varchar(255) | NULL   | 公司名称                   |
| address       | varchar(255) | NULL   | 地址                       |
| region_id     | int(11)      | NULL   | 所在区域ID                 |
| allow_region  | varchar(255) | NULL   | 所能接单区域id表           |
| type          | smallint(6)  | 0      | 0=总部公司,1=区域代理商     |
| created_at    | datetime     | NULL   | 创建时间                   |
| updated_at    | datetime     | NULL   | 更新时间                   |

### ls_company_comission - 运营公司佣金管理

| 字段名        | 类型         | 默认值 | 注释                       |
| ------------- | ------------ | ------ | -------------------------- |
| id            | int(11)      | NOT NULL AUTO_INCREMENT | 主键ID               |
| company_id    | int(11)      | NULL   | 运营商ID                   |
| total_fee     | decimal(10,2)| NULL   | 总收入                     |
| amount        | decimal(10,2)| NULL   | 佣金                       |
| remark        | text         | NULL   | 说明                       |
| created_at    | datetime     | NULL   | 结算时间                   |
| uid           | int(11)      | NULL   | 结算用户                   |

### ls_coupons - 优惠券表

| 字段名        | 类型                | 默认值 | 注释                       |
| ------------- | ------------------- | ------ | -------------------------- |
| id            | int(11)             | NOT NULL AUTO_INCREMENT | 优惠券ID               |
| coupon_type   | varchar(50)         | NOT NULL | 优惠券类型                 |
| coupon_name   | varchar(100)        | NOT NULL | 优惠券名称                 |
| face_value    | decimal(10,2)       | NULL   | 优惠券面值                 |
| min_consume   | decimal(10,2)       | NULL   | 满减券的最低消费金额       |
| start_time    | datetime            | NULL   | 生效时间                   |
| end_time      | datetime            | NULL   | 失效时间                   |
| total_num     | int(11)             | NULL   | 总数量                     |
| remaining_quantity | int(11)        | NULL   | 剩余数量                   |
| description   | text                | NULL   | 描述                       |
| create_time   | datetime            | CURRENT_TIMESTAMP | 创建时间         |

### ls_driver - 司机表

| 字段名        | 类型                | 默认值 | 注释                       |
| ------------- | ------------------- | ------ | -------------------------- |
| id            | bigint(20)          | NOT NULL AUTO_INCREMENT | 司机ID               |
| username      | varchar(50)         | NULL   | 用户名                     |
| password      | varchar(100)        | NULL   | 密码                       |
| token         | varchar(100)        | NULL   | 登录token                  |
| truename      | varchar(50)         | NULL   | 真实姓名                   |
| phone         | varchar(30)         | NULL   | 手机号                     |
| avatar        | varchar(255)        | NULL   | 头像                       |
| sex           | smallint(6)         | 0      | 性别：0=男，1=女           |
| idcard        | varchar(20)         | NULL   | 身份证                     |
| face_img      | varchar(255)        | NULL   | 正面照                     |
| score         | varchar(20)         | NULL   | 综合评分                   |
| driving_age   | int(11)            | NULL   | 驾龄                       |
| driving_licence | varchar(255)   | NULL   | 驾驶证照片地址             |
| car_licence   | varchar(255)        | NULL   | 行车证照片地址             |
| insure_img    | varchar(255)        | NULL   | 保单照片                   |
| car_img       | varchar(500)        | NULL   | 车辆照片                   |
| car_no        | varchar(10)         | NULL   | 车牌号                     |
| car_age       | int(11)            | NULL   | 车龄                       |
| car_brand     | varchar(20)         | NULL   | 品牌                       |
| car_color     | varchar(10)         | NULL   | 颜色                       |
| car_type      | varchar(10)         | NULL   | 类型：轿车,suv             |
| last_ip       | varchar(20)         | NULL   | 最后登录IP                 |
| last_time     | varchar(20)         | NULL   | 最近登录时间               |
| company_id    | int(11)            | NULL   | 所属运营公司               |
| recommend_uid  | int(11)            | NULL   | 推荐司机ID                 |
| online        | smallint(6)         | 0      | 在线状态：0=未在线,1=在线   |
| work_status   | smallint(6)         | 0      | 工作状态：0=下班，1=上班    |
| online_total_time | int(11)      | NULL   | 总在线时长（秒）           |
| created_at    | datetime            | NULL   | 注册日期                   |

### ls_driver_account - 司机帐目表

| 字段名        | 类型         | 默认值 | 注释                       |
| ------------- | ------------ | ------ | -------------------------- |
| id            | bigint(20)   | NOT NULL AUTO_INCREMENT | 帐目ID               |
| driver_id     | bigint(20)   | NULL   | 司机ID                     |
| fee           | decimal(10,2)| NULL   | 金额+,-                    |
| remark        | varchar(255) | NULL   | 帐目说明                   |
| created_at    | datetime     | NULL   | 入帐时间                   |

### ls_map_fence - 电子围栏表

| 字段名        | 类型         | 默认值 | 注释                       |
| ------------- | ------------ | ------ | -------------------------- |
| id            | int(11)      | NOT NULL AUTO_INCREMENT | 围栏ID               |
| company_id    | int(11)      | NULL   | 所属公司ID                 |
| latlng        | text         | NULL   | 可使用的电子围栏范围       |

### ls_order - 订单表

| 字段名        | 类型         | 默认值 | 注释                       |
| ------------- | ------------ | ------ | -------------------------- |
| id            | int(11)      | NOT NULL AUTO_INCREMENT | 订单ID               |
| sn            | varchar(50)  | NULL   | 订单编号                   |
| user_id       | int(11)      | NOT NULL | 乘客ID                     |
| driver_id     | int(11)      | NOT NULL | 司机ID                     |
| from_location | varchar(255) | NOT NULL | 出发地                     |
| to_location   | varchar(255) | NOT NULL | 目的地                     |
| up_time       | datetime     | NOT NULL | 上车时间                   |
| down_time     | datetime     | NULL   | 下车时间                   |
| to_latlng     | varchar(30)  | NULL   | 下车地坐标                 |
| from_latlng   | varchar(30)  | NULL   | 上车地坐标                 |
| order_time    | datetime     | CURRENT_TIMESTAMP | 下单时间         |
| waiting_time  | int(11)      | NULL   | 等待时长(秒）              |
| accept_time   | datetime     | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 接单时间     |
| distance      | float(10,2)  | NULL   | 订单路程                   |
| predict_fee   | decimal(10,2)| NULL   | 预估费用                   |
| insurance_fee | decimal(10,2)| NULL   | 保单费用                   |
| total_fee     | decimal(10,2)| NULL   | 订单费用                   |
| pay_type      | varchar(20)  | NULL   | 支付方式                   |
| invoice       | smallint(6)  | 0      | 是否已开票                 |
| discount      | decimal(10,1)| NULL   | 折扣                       |
| coupon_id     | int(11)      | NULL   | 优惠券ID                   |
| fee           | decimal(10,2)| NULL   | 实际支付金额               |
| status        | smallint(6)  | 0      | 订单状态                   |
| order_type    | smallint(6)  | NULL   | 订单类型                   |
| is_dispatch   | smallint(6)  | 0      | 是否调度派遣               |
| driver_commission | decimal(10,2) | NULL   | 司机佣金              |
| add_fee       | decimal(10,2)| NULL   | 加价叫车金额               |

### ls_order_complaint - 订单投诉表

| 字段名        | 类型         | 默认值 | 注释                        |
| ------------- | ------------ | ------ | -------------------------- |
| id            | int(11)      | NOT NULL AUTO_INCREMENT | 投诉ID    |
| order_id      | int(11)      | NULL   | 订单ID                     |
| driver_id     | int(11)      | NULL   | 司机ID                     |
| content       | varchar(255) | NULL   | 投诉内容                   |
| user_id       | int(11)      | NULL   | 乘客ID                     |
| remark        | varchar(255) | NULL   | 处理结果                   |
| created_at    | datetime     | NULL   | 投诉时间                   |
| updated_at    | datetime     | NULL   | 处理时间                   |

### ls_order_rating - 订单评分表

| 字段名        | 类型         | 默认值 | 注释                       |
| ------------- | ------------ | ------ | -------------------------- |
| id            | bigint(20)   | NOT NULL AUTO_INCREMENT | 评分ID     |
| order_id      | bigint(20)   | NULL   | 订单ID                     |
| driver_id     | int(11)      | NULL   | 司机ID                     |
| score         | float(5,2)   | NULL   | 评分                       |
| score_item    | varchar(20)  | NULL   | 评分项                     |
| remark        | varchar(255) | NULL   | 用户评语                   |
| user_id       | int(11)      | NULL   | 乘客ID                     |
| created_at    | datetime     | NULL   | 评分时间                   |

### ls_order_transfer - 订单转派表

| 字段名        | 类型         | 默认值 | 注释                       |
| ------------- | ------------ | ------ | -------------------------- |
| id            | int(11)      | NOT NULL AUTO_INCREMENT | 转派ID    |
| order_id      | bigint(20)   | NULL   | 订单ID                     |
| source_driver_id | int(11)  | NULL   | 源司机ID                   |
| target_driver_id | int(11)  | NULL   | 目标司机ID                 |
| remark        | varchar(255) | NULL   | 备注                       |
| dispatch_id   | int(11)      | 0      | 调度员ID，0=表示司机转单   |
| created_at    | datetime     | NULL   | 创建时间                   |

### ls_region - 区域表

| 字段名        | 类型         | 默认值 | 注释                       |
| ------------- | ------------ | ------ | -------------------------- |
| id            | int(11)      | NOT NULL AUTO_INCREMENT | 区域ID    |
| parent_id     | int(11)      | NULL   | 上级区域ID                 |
| name          | varchar(100) | NULL   | 区域名称                   |

### ls_travel_price - 各时段计费规则

| 字段名        | 类型         | 默认值 | 注释                       |
| ------------- | ------------ | ------ | -------------------------- |
| id            | int(11)      | NOT NULL AUTO_INCREMENT | 规则ID               |
| region_id     | int(11)      | NOT NULL | 区域ID                     |
| start_time    | datetime     | NOT NULL | 开始时间                   |
| end_time      | datetime     | NOT NULL | 结束时间                   |
| price_per_km  | decimal(5,2) | NOT NULL | 每公里价格                 |
| bz            | text         | NULL   | 备注                       |
| surcharge     | decimal(5,2) | NULL   | 附加费用                   |
| create_time   | datetime     | CURRENT_TIMESTAMP | 创建时间         |
| update_time   | datetime     | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间     |

### ls_user - 后台用户表

| 字段名        | 类型         | 默认值 | 注释                       |
| ------------- | ------------ | ------ | -------------------------- |
| id            | int(11)      | NOT NULL AUTO_INCREMENT | 用户ID               |
| username      | varchar(20)  | NULL   | 用户名                     |
| password      | varchar(100) | NULL   | 密码                       |
| truename      | varchar(100) | NULL   | 真实姓名                   |
| phone         | varchar(50)  | NULL   | 手机号                     |
| is_admin      | smallint(6)  | 0      | 是否管理员                 |
| utype         | smallint(6)  | 0      | 用户类型                   |
| parent_id     | int(11)      | NULL   | 上级用户ID                 |
| company_id    | int(11)      | NULL   | 所属公司ID                 |
| status        | smallint(6)  | 0      | 用户状态                   |
| last_ip       | varchar(30)  | NULL   | 最后登录IP                 |
| last_time     | varchar(30)  | NULL   | 最后登录时间               |
| created_at    | datetime     | NULL   | 创建时间                   |
| updated_at    | datetime     | NULL   | 更新时间                   |

### ls_user_coupons - 用户领取优惠券记录表

| 字段名        | 类型         | 默认值 | 注释                       |
| ------------- | ------------ | ------ | -------------------------- |
| id            | int(11)      | NOT NULL AUTO_INCREMENT | 记录ID               |
| user_id       | int(11)      | NOT NULL | 用户ID                     |
| user_type     | tinyint(1)   | 0      | 用户类型                   |
| coupon_id     | int(11)      | NOT NULL | 优惠券ID                   |
| receive_time  | datetime     | CURRENT_TIMESTAMP | 领取时间         |
| is_used       | tinyint(1)   | 0      | 是否已使用                 |
| use_time      | datetime     | NULL   | 使用时间                   |

### ls_user_log - 用户日志表

| 字段名        | 类型         | 默认值 | 注释                       |
| ------------- | ------------ | ------ | -------------------------- |
| id            | bigint(20)   | NOT NULL AUTO_INCREMENT | 日志ID               |
| uid           | int(11)      | NULL   | 用户ID                     |
| content       | varchar(255) | NULL   | 日志内容                   |
| ip            | varchar(30)  | NULL   | IP地址                     |
| created_at    | datetime     | NULL   | 创建时间                   |

### ls_wechat_user - 乘客表

| 字段名        | 类型         | 默认值 | 注释                       |
| ------------- | ------------ | ------ | -------------------------- |
| id            | bigint(20)   | NOT NULL AUTO_INCREMENT | 乘客ID               |
| openid        | varchar(80)  | NULL   | 微信openid                 |
| token         | varchar(100) | NULL   | 登录token                  |
| phone         | varchar(30)  | NULL   | 电话号码                   |
| truename      | varchar(20)  | NULL   | 真实姓名                   |
| nickname      | varchar(30)  | NULL   | 昵称                       |
| status        | smallint(6)  | 0      | 用户状态                   |
| avatar        | varchar(255) | NULL   | 头像                       |
| level         | smallint(6)  | 0      | 会员等级                   |
| last_time     | varchar(30)  | NULL   | 最近使用时间               |
| last_ip       | varchar(20)  | NULL   | 最后登录IP                 |
| recommend_uid | int(11)      | NULL   | 推荐人(司机)ID             |
| created_at    | datetime     | NULL   | 注册时间                   |
| updated_at    | datetime     | NULL   | 更新时间                   |

### ls_wechat_user - 乘客表

| 字段名        | 类型         | 默认值 | 注释                       |
| ------------- | ------------ | ------ | -------------------------- |
| id            | bigint(20)   | NOT NULL AUTO_INCREMENT | 乘客ID               |
| title         | varchar(80)  | NULL   | 微信openid                 |
| token         | varchar(100) | NULL   | 登录token                  |
| phone         | varchar(30)  | NULL   | 电话号码                   |
| truename      | varchar(20)  | NULL   | 真实姓名                   |
| nickname      | varchar(30)  | NULL   | 昵称                       |
| status        | smallint(6)  | 0      | 用户状态                   |
| avatar        | varchar(255) | NULL   | 头像                       |
| level         | smallint(6)  | 0      | 会员等级                   |
| last_time     | varchar(30)  | NULL   | 最近使用时间               |
| last_ip       | varchar(20)  | NULL   | 最后登录IP                 |
| recommend_uid | int(11)      | NULL   | 推荐人(司机)ID             |
| created_at    | datetime     | NULL   | 注册时间                   |
| updated_at    | datetime     | NULL   | 更新时间                   |

### 发票表
CREATE TABLE `ls_invoice` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '自增主键ID',
  `invoice_id` varchar(32) NOT NULL COMMENT '发票申请ID（业务ID）',
  `user_id` varchar(32) NOT NULL COMMENT '用户ID',
  `user_name` varchar(64) NOT NULL COMMENT '用户名',
  `user_phone` varchar(20) COMMENT '用户手机号',
  `invoice_type` enum('personal','company') NOT NULL DEFAULT 'personal' COMMENT '发票类型：personal-个人，company-企业',
  `invoice_title` varchar(128) COMMENT '发票抬头（企业发票必填）',
  `tax_number` varchar(32) COMMENT '纳税人识别号（企业发票必填）',
  `amount` decimal(12,2) NOT NULL COMMENT '发票金额',
  `email` varchar(128) NOT NULL COMMENT '接收电子发票的邮箱',
  `status` enum('pending','approved','rejected','issued') NOT NULL DEFAULT 'pending' COMMENT '状态：pending-待处理，approved-已通过，rejected-已拒绝，issued-已开具',
  `apply_time` datetime NOT NULL COMMENT '申请时间',
  `process_time` datetime COMMENT '处理时间',
  `processor` varchar(32) COMMENT '处理人',
  `reject_reason` varchar(255) COMMENT '拒绝原因',
  `invoice_file` varchar(255) COMMENT '发票文件路径',
  `invoice_code` varchar(32) COMMENT '发票代码',
  `invoice_number` varchar(32) COMMENT '发票号码',
  `issue_time` datetime COMMENT '开具时间',
  `remark` varchar(500) COMMENT '备注',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_invoice_id` (`invoice_id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_status` (`status`),
  KEY `idx_apply_time` (`apply_time`),
  KEY `idx_process_time` (`process_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='发票申请表';